---
import { useI18n } from '../../i18n/utils';
import Container from '../ui/Container.astro';

const { t, lang } = useI18n(Astro.url);

// Image paths for stone grades
const stoneImages = {
  aPlusPlus: '/images/26d483a8073164eff5528e49cd44d914e594b8e5.png',
  aPlus: '/images/c267197a2cfe6eb447d0bc2c28a0208a6d93b89e.png',
  a: '/images/a04e88f2456f5503d20950b28dd386f0f8b55b3b.png',
};

// Image paths for detail levels
const detailImages = {
  minimal: '/images/13ba63e01b4af986d598682d96e0f684ab188e70.png',
  refine: '/images/13ba63e01b4af986d598682d96e0f684ab188e70.png', // Using minimal as placeholder
  realistic: '/images/e1c52a1a4e99255d1ee041a902eb29a962d3d593.png',
};

// Image paths for sculpture type tabs
const tabImages = {
  bust: '/images/13ba63e01b4af986d598682d96e0f684ab188e70.png',
  relief: '/images/e1c52a1a4e99255d1ee041a902eb29a962d3d593.png',
};

const stoneData = [
  { 
    id: 'aPlusPlus', 
    image: stoneImages.aPlusPlus,
    name: t.priceEstimation.steps.stoneCategory.grades.aPlusPlus.label
  },
  { 
    id: 'aPlus', 
    image: stoneImages.aPlus,
    name: t.priceEstimation.steps.stoneCategory.grades.aPlus.label
  },
  { 
    id: 'a', 
    image: stoneImages.a,
    name: t.priceEstimation.steps.stoneCategory.grades.a.label
  },
];

const detailData = [
  { 
    id: 'minimal', 
    image: detailImages.minimal,
    name: t.priceEstimation.steps.detailLevel.levels.minimal.label,
    desc: t.priceEstimation.steps.detailLevel.levels.minimal.description
  },
  { 
    id: 'refine', 
    image: detailImages.refine,
    name: t.priceEstimation.steps.detailLevel.levels.refine.label,
    desc: t.priceEstimation.steps.detailLevel.levels.refine.description
  },
  { 
    id: 'realistic', 
    image: detailImages.realistic,
    name: t.priceEstimation.steps.detailLevel.levels.realistic.label,
    desc: t.priceEstimation.steps.detailLevel.levels.realistic.description
  },
];

// Materials page link based on language
const materialsLink = lang === 'en' ? '/materials' : `/${lang}/materials`;
---

<section class="py-16 lg:py-24 bg-gray-50" id="price-estimation">
  <Container>
    <div class="mx-auto max-w-[700px]">
    <!-- Section Header -->
    <div class="text-center mb-8" id="section-header">
      <h2 class="text-3xl lg:text-4xl font-bold text-brand-primary mb-4 uppercase">
        {t.priceEstimation.title}
      </h2>
      <p class="text-gray-600 text-base lg:text-lg max-w-2xl mx-auto">
        {t.priceEstimation.subtitle}
      </p>
    </div>

    <!-- Main Calculator Card -->
    <!-- Added mx-auto to center it when width changes -->
    <div 
      class="bg-white rounded-2xl shadow-xl overflow-hidden mx-auto" 
      data-calculator 
      data-state="initial"
      id="calculator-container"
    >
      <!-- Tab Header -->
      <div 
        class="flex flex-row border-b border-brand-medium/30 relative h-[200px] sm:h-[300px]" 
        role="tablist" 
        aria-label="Sculpture type"
        id="tab-container"
      >
        <button
          id="bust-tab"
          role="tab"
          aria-selected="false"
          aria-controls="bust-panel"
          class="group flex-1 flex flex-col items-center justify-center overflow-hidden bg-[#9b96d3] hover:bg-[#8a85c2] transition-colors duration-300 focus:outline-none relative"
          data-tab="bust"
        >
          <div class="absolute inset-0 group-hover:scale-105 transition-transform duration-500 tab-image-container">
            <img
              src={tabImages.bust}
              alt="Bust sculpture"
              class="w-full h-full object-cover"
              loading="lazy"
            />
            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors tab-overlay"></div>
          </div>
          <div class="relative z-10 py-3 px-2 sm:px-6 text-sm sm:text-xl lg:text-3xl font-extrabold text-white uppercase tracking-wider tab-text text-center">
            <span class="tab-text-short">{t.priceEstimation.bust.tabShort}</span>
            <span class="tab-text-full">{t.priceEstimation.bust.tab}</span>
          </div>
        </button>
        <button
          id="relief-tab"
          role="tab"
          aria-selected="false"
          aria-controls="relief-panel"
          class="group flex-1 flex flex-col items-center justify-center overflow-hidden bg-[#9b96d3] hover:bg-[#8a85c2] transition-colors duration-300 focus:outline-none relative"
          data-tab="relief"
        >
          <div class="absolute inset-0 group-hover:scale-105 transition-transform duration-500 tab-image-container">
            <img
              src={tabImages.relief}
              alt="Relief sculpture"
              class="w-full h-full object-cover"
              loading="lazy"
            />
            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors tab-overlay"></div>
          </div>
          <div class="relative z-10 py-3 px-2 sm:px-6 text-sm sm:text-xl lg:text-3xl font-extrabold text-white uppercase tracking-wider tab-text text-center">
            <span class="tab-text-short">{t.priceEstimation.relief.tabShort}</span>
            <span class="tab-text-full">{t.priceEstimation.relief.tab}</span>
          </div>
        </button>
      </div>

      <!-- Calculator Content (hidden until tab selected) -->
      <!-- Calculator Content (hidden until tab selected) -->
      <div 
        class="p-6 lg:p-8 space-y-8 opacity-0 hidden" 
        id="calculator-content"
      >
        <!-- Step 1: Dimensions -->
        <div class="space-y-4" data-step="dimensions">
          <h3 class="text-base font-normal text-gray-800">
            {t.priceEstimation.steps.dimensions.title}
          </h3>

          <!-- Dimension Inputs -->
          <div class="grid grid-cols-3 gap-4">
            <!-- Height -->
            <div class="space-y-2">
              <label for="dimension-height" class="block text-sm text-gray-600">
                {t.priceEstimation.steps.dimensions.height}
              </label>
              <input
                type="number"
                id="dimension-height"
                name="height"
                min="1"
                max="3000"
                placeholder="e.g., 600"
                class="dimension-input w-full h-[50px] px-4 border border-gray-300 rounded-lg text-base focus:outline-none focus:border-brand-primary focus:ring-2 focus:ring-brand-primary/20 transition-colors"
                data-dimension="height"
              />
              <p class="text-xs text-gray-500">{t.priceEstimation.steps.dimensions.maxHint}</p>
            </div>

            <!-- Width -->
            <div class="space-y-2">
              <label for="dimension-width" class="block text-sm text-gray-600">
                {t.priceEstimation.steps.dimensions.width}
              </label>
              <input
                type="number"
                id="dimension-width"
                name="width"
                min="1"
                max="3000"
                placeholder="e.g., 450"
                class="dimension-input w-full h-[50px] px-4 border border-gray-300 rounded-lg text-base focus:outline-none focus:border-brand-primary focus:ring-2 focus:ring-brand-primary/20 transition-colors"
                data-dimension="width"
              />
              <p class="text-xs text-gray-500">{t.priceEstimation.steps.dimensions.maxHint}</p>
            </div>

            <!-- Depth -->
            <div class="space-y-2">
              <label for="dimension-depth" class="block text-sm text-gray-600">
                {t.priceEstimation.steps.dimensions.depth}
              </label>
              <input
                type="number"
                id="dimension-depth"
                name="depth"
                min="1"
                max="3000"
                placeholder="e.g., 300"
                class="dimension-input w-full h-[50px] px-4 border border-gray-300 rounded-lg text-base focus:outline-none focus:border-brand-primary focus:ring-2 focus:ring-brand-primary/20 transition-colors"
                data-dimension="depth"
              />
              <p class="text-xs text-gray-500">{t.priceEstimation.steps.dimensions.maxHint}</p>
            </div>
          </div>

          <!-- Remark Box -->
          <div class="bg-[#fff6f6] border-l-4 border-accent-red rounded-r px-3 py-2 sm:px-4 sm:py-3">
            <p class="text-xs sm:text-sm text-accent-red" set:html={t.priceEstimation.steps.dimensions.remark}></p>
          </div>
        </div>

        <!-- Step 2: Stone Category -->
        <div class="space-y-4" data-step="stone">
          <h3 class="text-base font-normal text-gray-800">
            {t.priceEstimation.steps.stoneCategory.title}
          </h3>

              <!-- Stone Category Grid -->
              <div class="grid grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6">
                {stoneData.map((stone) => (
                  <label class="cursor-pointer group relative">
                    <input type="radio" name="stoneType" value={stone.id} class="peer sr-only" />
                    <div class="
                      bg-white rounded-[14px] sm:rounded-[22px] border-2 border-transparent 
                      p-2 sm:p-4 text-center transition-all duration-300
                      peer-checked:border-[#2C266C] peer-checked:shadow-lg
                      hover:shadow-md h-full flex flex-col justify-between
                    ">
                      <div class="w-full aspect-square bg-gray-100 rounded-[10px] sm:rounded-[18px] mb-2 sm:mb-3 overflow-hidden">
                        <img 
                          src={stone.image} 
                          alt={stone.name}
                          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                        />
                      </div>
                      <span class="block text-xs sm:text-base font-medium text-[#2C266C]">
                        {stone.name}
                      </span>
                    </div>
                  </label>
                ))}
              </div>
          <!-- Help Box -->
          <div class="bg-[#fef2f2] border-l-4 border-accent-red rounded-r px-3 py-2 sm:px-4 sm:py-3">
            <p class="text-xs sm:text-sm text-[#9f0712]">
              <span set:html={t.priceEstimation.steps.stoneCategory.help.split('Visit')[0]}></span>
              <a href={materialsLink} class="underline hover:no-underline">Visit our Materials Page</a>
              {t.priceEstimation.steps.stoneCategory.help.split('Materials Page')[1]?.replace('</strong>', '') || ' to learn more about stone categories and find the right grade for your project.'}
            </p>
          </div>
        </div>

        <!-- Step 3: Detail Level -->
        <div class="space-y-4" data-step="detail">
          <h3 class="text-base font-normal text-gray-800">
            {t.priceEstimation.steps.detailLevel.title}
          </h3>

          <!-- Detail Level Cards -->
              <div class="grid grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6">
                {detailData.map((level) => (
                  <label class="cursor-pointer group relative">
                    <input type="radio" name="detailLevel" value={level.id} class="peer sr-only" />
                    <div class="
                      bg-white rounded-[14px] sm:rounded-[22px] border-2 border-transparent 
                      p-2 sm:p-4 text-center transition-all duration-300
                      peer-checked:border-[#2C266C] peer-checked:shadow-lg
                      hover:shadow-md h-full flex flex-col justify-between
                    ">
                      <div class="w-full aspect-square bg-gray-100 rounded-[10px] sm:rounded-[18px] mb-2 sm:mb-3 overflow-hidden">
                        <img 
                          src={level.image} 
                          alt={level.name}
                          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                        />
                      </div>
                      
                      <span class="block text-xs sm:text-base font-medium text-[#2C266C] mb-0.5 sm:mb-1">
                        {level.name}
                      </span>
                      <span class="block text-[10px] sm:text-sm text-gray-500 leading-tight line-clamp-2">
                        {level.desc}
                      </span>
                    </div>
                  </label>
                ))}
              </div>
        </div>

        <!-- Calculate Button -->
        <button
          type="button"
          id="calculate-btn"
          disabled
          class="w-full h-14 rounded-lg text-base font-normal transition-all duration-300 bg-gray-300 text-gray-500 cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed enabled:bg-brand-primary enabled:text-white enabled:cursor-pointer enabled:hover:bg-brand-primary/90 flex items-center justify-center gap-2"
          data-calculate
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
          <span>{t.priceEstimation.calculateButton}</span>
        </button>

        <!-- Price Result (Hidden initially) -->
        <div id="price-result" class="hidden mt-6 p-6 bg-brand-primary rounded-lg text-center" aria-live="polite">
          <p class="text-white/80 text-sm mb-2">{t.priceEstimation.estimatedPrice}</p>
          <p id="price-value" class="text-4xl font-bold text-white mb-2">$0.00</p>
          <p class="text-white/60 text-xs">{t.priceEstimation.priceDisclaimer}</p>
        </div>

        <!-- Contact CTA -->
        <div class="text-center pt-4">
          <a
            href="#contact"
            class="inline-block px-8 py-3 bg-bmg-gold text-white font-semibold rounded-lg hover:bg-bmg-gold/90 transition-colors"
          >
            {t.priceEstimation.getCustomQuote}
          </a>
        </div>
      </div>
    </div>
    </div>
  </Container>
</section>

<script>
  import { animate, stagger } from "motion";

  document.addEventListener('DOMContentLoaded', () => {
    // State
    interface CalculatorState {
      activeTab: 'bust' | 'relief' | null;  // null until user explicitly selects
      tabSelected: boolean;  // tracks if user has made an explicit selection
      dimensions: {
        height: number;
        width: number;
        depth: number;
      };
      stoneGrade: string | null;
      stonePricePerMm3: number;
      detailLevel: string | null;
      detailAddition: number;
    }

    const state: CalculatorState = {
      activeTab: null,  // no default selection
      tabSelected: false,
      dimensions: { height: 0, width: 0, depth: 0 },
      stoneGrade: null,
      stonePricePerMm3: 0,
      detailLevel: null,
      detailAddition: 0,
    };

    // Elements
    const calculatorContainer = document.getElementById('calculator-container');
    const tabContainer = document.getElementById('tab-container');
    const sectionHeader = document.getElementById('section-header');
    
    // Original elements
    const bustTab = document.getElementById('bust-tab');
    const reliefTab = document.getElementById('relief-tab');
    const calculateBtn = document.getElementById('calculate-btn');
    const priceResult = document.getElementById('price-result');
    const priceValue = document.getElementById('price-value');
    const dimensionInputs = document.querySelectorAll<HTMLInputElement>('.dimension-input');
    const stoneCards = document.querySelectorAll<HTMLButtonElement>('.stone-card');
    const detailCards = document.querySelectorAll<HTMLButtonElement>('.detail-card');
    const calculatorContent = document.getElementById('calculator-content');

    // Tab switching with new animation logic
    // Tab switching with simplified "classy" animation
    async function switchTab(tab: 'bust' | 'relief') {
      state.activeTab = tab;

      // FIRST TIME SELECTION: Major layout change
      if (!state.tabSelected) {
        state.tabSelected = true;

        // 1. FADE OUT EVERYTHING (Header + Calculator Container)
        // We fade out the container so the "snap" resize happens while invisible.
        const fadeOutPromises = [];
        
        if (sectionHeader) {
          fadeOutPromises.push(
            animate(sectionHeader, { opacity: 0 } as any, { duration: 0.3 } as any).finished
          );
        }
        
        if (calculatorContainer) {
          fadeOutPromises.push(
            animate(calculatorContainer, { opacity: 0 } as any, { duration: 0.3 } as any).finished
          );
        }
        
        await Promise.all(fadeOutPromises);

        // 2. STATE SWITCH (Invisible)
        // Apply all layout changes instantly while opacity is 0.
        
        // Hide header completely layout-wise
        if (sectionHeader) {
          sectionHeader.style.display = 'none';
        }

        // Activate calculator state
        calculatorContainer?.setAttribute('data-state', 'active');
        
        // Apply manual styles for the active state to ensure "snap"
        if (tabContainer) {
           tabContainer.style.height = '64px';
        }
        if (calculatorContainer) {
           calculatorContainer.style.maxWidth = '700px';
        }
        
        // Show calculator content (still opacity 0 from parent/self)
        if (calculatorContent) {
           calculatorContent.classList.remove('hidden');
           calculatorContent.style.opacity = '1'; // Reset its own opacity if needed
           
           // Ensure internal items are visible
           const sections = calculatorContent.querySelectorAll('[data-step], #submit-area');
           sections.forEach((el: any) => el.style.opacity = '1');
        }

        // Hide large images/text so the compact bar is correct
        // const tabImages = document.querySelectorAll('.tab-image-container');
        // tabImages.forEach((el: any) => el.style.opacity = '0');
        
        const tabTexts = document.querySelectorAll('.tab-text');
        // We assume CSS handles the font-size snap based on data-state or we rely on the fade.
        // If we need to force opacity 1 on texts (now small):
        tabTexts.forEach((el: any) => el.style.opacity = '1');


        // 3. FADE IN CALCULATOR (Container)
        if (calculatorContainer) {
          animate(calculatorContainer, { opacity: 1 } as any, { duration: 0.4, easing: "ease-out" } as any);
        }
        
      } else {
        // ALREADY ACTIVE: Just standard tab switching
        // We don't need to do anything special here as the click handler updates global state references
        // and 'updateTabVisuals' handles the class toggling.
      }

      // Update Visuals for Tabs (Colors, etc.)
      updateTabVisuals(tab);
      updateCalculateButton();
    }

    function updateTabVisuals(activeTab: 'bust' | 'relief') {
      if (activeTab === 'bust') {
        bustTab?.classList.remove('bg-[#9b96d3]', 'hover:bg-[#8a85c2]');
        bustTab?.classList.add('bg-brand-primary');
        bustTab?.setAttribute('aria-selected', 'true');

        reliefTab?.classList.remove('bg-brand-primary');
        reliefTab?.classList.add('bg-[#9b96d3]', 'hover:bg-[#8a85c2]');
        reliefTab?.setAttribute('aria-selected', 'false');
      } else {
        reliefTab?.classList.remove('bg-[#9b96d3]', 'hover:bg-[#8a85c2]');
        reliefTab?.classList.add('bg-brand-primary');
        reliefTab?.setAttribute('aria-selected', 'true');

        bustTab?.classList.remove('bg-brand-primary');
        bustTab?.classList.add('bg-[#9b96d3]', 'hover:bg-[#8a85c2]');
        bustTab?.setAttribute('aria-selected', 'false');
      }
    }

    bustTab?.addEventListener('click', () => switchTab('bust'));
    reliefTab?.addEventListener('click', () => switchTab('relief'));

    // Dimension inputs
    dimensionInputs.forEach((input) => {
      input.addEventListener('input', () => {
        const dimension = input.dataset.dimension as 'height' | 'width' | 'depth';
        let value = parseFloat(input.value) || 0;

        // Clamp to max
        if (value > 3000) {
          value = 3000;
          input.value = '3000';
        }

        state.dimensions[dimension] = Math.max(0, value);

        // Visual validation
        if (value > 0 && value <= 3000) {
          input.classList.remove('border-red-500');
          input.classList.add('border-green-500');
        } else if (value > 3000) {
          input.classList.remove('border-green-500');
          input.classList.add('border-red-500');
        } else {
          input.classList.remove('border-green-500', 'border-red-500');
        }

        updateCalculateButton();
      });
    });

    // Stone card selection
    stoneCards.forEach((card) => {
      card.addEventListener('click', () => {
        // Remove selection from all
        stoneCards.forEach((c) => {
          c.classList.remove('border-brand-primary', 'ring-2', 'ring-brand-primary');
          c.classList.add('border-gray-300');
          c.setAttribute('aria-checked', 'false');
        });

        // Select this card
        card.classList.remove('border-gray-300');
        card.classList.add('border-brand-primary', 'ring-2', 'ring-brand-primary');
        card.setAttribute('aria-checked', 'true');

        state.stoneGrade = card.dataset.stone || null;
        state.stonePricePerMm3 = parseFloat(card.dataset.price || '0');

        updateCalculateButton();
      });

      // Keyboard navigation
      card.addEventListener('keydown', (e: KeyboardEvent) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          const cards = Array.from(stoneCards);
          const currentIndex = cards.indexOf(card);
          let newIndex: number;

          if (e.key === 'ArrowRight') {
            newIndex = (currentIndex + 1) % cards.length;
          } else {
            newIndex = (currentIndex - 1 + cards.length) % cards.length;
          }

          (cards[newIndex] as HTMLButtonElement).click();
          (cards[newIndex] as HTMLButtonElement).focus();
        }
      });
    });

    // Detail card selection
    detailCards.forEach((card) => {
      card.addEventListener('click', () => {
        // Remove selection from all
        detailCards.forEach((c) => {
          c.classList.remove('border-brand-primary', 'ring-2', 'ring-brand-primary');
          c.classList.add('border-gray-300');
          c.setAttribute('aria-checked', 'false');
        });

        // Select this card
        card.classList.remove('border-gray-300');
        card.classList.add('border-brand-primary', 'ring-2', 'ring-brand-primary');
        card.setAttribute('aria-checked', 'true');

        state.detailLevel = card.dataset.detail || null;
        state.detailAddition = parseFloat(card.dataset.addition || '0');

        updateCalculateButton();
      });

      // Keyboard navigation
      card.addEventListener('keydown', (e: KeyboardEvent) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          const cards = Array.from(detailCards);
          const currentIndex = cards.indexOf(card);
          let newIndex: number;

          if (e.key === 'ArrowRight') {
            newIndex = (currentIndex + 1) % cards.length;
          } else {
            newIndex = (currentIndex - 1 + cards.length) % cards.length;
          }

          (cards[newIndex] as HTMLButtonElement).click();
          (cards[newIndex] as HTMLButtonElement).focus();
        }
      });
    });

    // Check if all selections are complete
    function isFormComplete(): boolean {
      const { dimensions, stoneGrade, detailLevel } = state;
      return (
        dimensions.height > 0 &&
        dimensions.width > 0 &&
        dimensions.depth > 0 &&
        stoneGrade !== null &&
        detailLevel !== null
      );
    }

    // Update calculate button state
    function updateCalculateButton() {
      if (calculateBtn) {
        if (isFormComplete()) {
          calculateBtn.removeAttribute('disabled');
        } else {
          calculateBtn.setAttribute('disabled', '');
        }
      }
    }

    // Calculate price
    function calculatePrice(): number {
      const { dimensions, stonePricePerMm3, detailAddition } = state;
      const volume = dimensions.height * dimensions.width * dimensions.depth;
      const basePrice = volume * stonePricePerMm3;
      return basePrice + detailAddition;
    }

    // Format price
    function formatPrice(price: number): string {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }).format(price);
    }

    // Calculate button click
    calculateBtn?.addEventListener('click', () => {
      if (!isFormComplete()) return;

      const price = calculatePrice();

      if (priceValue) {
        priceValue.textContent = formatPrice(price);
      }

      priceResult?.classList.remove('hidden');

      // Scroll to result
      priceResult?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    // Initialize
    updateCalculateButton();
  });
</script>

<style>
  /* Selected card styles */
  .stone-card[aria-checked="true"],
  .detail-card[aria-checked="true"] {
    border-color: var(--color-brand-primary);
    box-shadow: 0 0 0 2px var(--color-brand-primary);
  }

  /* Input validation states */
  .dimension-input.border-green-500 {
    border-color: #22c55e;
  }

  .dimension-input.border-red-500 {
    border-color: #ef4444;
  }
  
  /* ANIMATION STATES */
  /* Most states are now handled by Motion One JS, but we keep these for basic layout */
  
  [data-calculator][data-state="active"] .tab-image-container {
    pointer-events: none;
  }

  [data-calculator][data-state="active"] .tab-text {
    font-size: 1.125rem; /* text-lg */
    white-space: nowrap;
    padding-top: 0;
    padding-bottom: 0;
  }

  /* Tab text short/full visibility */
  /* Default: show full text, hide short text */
  .tab-text-short {
    display: none;
  }
  .tab-text-full {
    display: inline;
  }

  /* When calculator is active AND on mobile: show short, hide full */
  @media (max-width: 639px) {
    [data-calculator][data-state="active"] .tab-text-short {
      display: inline;
    }
    [data-calculator][data-state="active"] .tab-text-full {
      display: none;
    }
  }
  
  @media (min-width: 1024px) {
    [data-calculator][data-state="active"] .tab-text {
      font-size: 1.25rem; /* text-xl */
    }
  }

  /* Active Calculator State - Default for contained tabs */
  [data-calculator][data-state="active"] .tab-overlay {
    background-color: rgb(44 38 108 / 0.5); /* brand-primary/50 - Light Blue for inactive */
  }

  [data-calculator][data-state="active"] .group:hover .tab-overlay {
    background-color: rgb(44 38 108 / 0.6);
  }

  /* Active/Selected Tab Overlay Style (More Specific) */
  [data-calculator][data-state="active"] #bust-tab[aria-selected="true"] .tab-overlay,
  [data-calculator][data-state="active"] #relief-tab[aria-selected="true"] .tab-overlay {
    background-color: rgb(44 38 108 / 0.85); /* brand-primary/85 - Deep Blue */
  }
  
  [data-calculator][data-state="active"] #bust-tab[aria-selected="true"]:hover .tab-overlay,
  [data-calculator][data-state="active"] #relief-tab[aria-selected="true"]:hover .tab-overlay {
    background-color: rgb(44 38 108 / 0.95); /* brand-primary/95 */
  }
</style>
