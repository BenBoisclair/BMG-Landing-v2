---
import { useI18n } from '../../i18n/utils';

const { t } = useI18n(Astro.url);
---

<section class="py-16 lg:py-24 bg-white" id="price-estimation">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <h2 class="text-3xl lg:text-4xl font-bold text-center mb-8 text-brand-primary">
      {t.priceEstimation.title}
    </h2>

    <!-- Tab Container -->
    <div class="w-full">
      <!-- Tab Buttons -->
      <div class="flex rounded-lg overflow-hidden border-2 border-brand-dark" role="tablist" aria-label="Price estimation calculator type">
        <button
          id="bust-tab"
          role="tab"
          aria-selected="false"
          aria-controls="bust-panel"
          class="flex-1 py-4 px-6 text-xl lg:text-2xl font-semibold text-white bg-brand-medium hover:bg-brand-medium-hover transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-brand-dark focus:ring-offset-2"
          data-tab="bust"
        >
          {t.priceEstimation.bust.tab}
        </button>
        <button
          id="relief-tab"
          role="tab"
          aria-selected="false"
          aria-controls="relief-panel"
          class="flex-1 py-4 px-6 text-xl lg:text-2xl font-semibold text-white bg-brand-medium hover:bg-brand-medium-hover transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-brand-dark focus:ring-offset-2"
          data-tab="relief"
        >
          {t.priceEstimation.relief.tab}
        </button>
      </div>

      <!-- Tab Panels -->
      <!-- Bust Calculator Panel -->
      <div
        id="bust-panel"
        role="tabpanel"
        aria-labelledby="bust-tab"
        class="mt-6 p-6 bg-gray-50 rounded-lg border border-gray-200 hidden"
      >
        <h3 class="text-xl font-semibold text-brand-dark mb-4">{t.priceEstimation.bust.title}</h3>

        <!-- Size Selection -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.bust.selectSize}</label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button class="bust-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="small" data-price="2500">
              <span class="block font-semibold">{t.priceEstimation.bust.sizes.small.label}</span>
              <span class="block text-sm">{t.priceEstimation.bust.sizes.small.description}</span>
            </button>
            <button class="bust-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="medium" data-price="4500">
              <span class="block font-semibold">{t.priceEstimation.bust.sizes.medium.label}</span>
              <span class="block text-sm">{t.priceEstimation.bust.sizes.medium.description}</span>
            </button>
            <button class="bust-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="large" data-price="7500">
              <span class="block font-semibold">{t.priceEstimation.bust.sizes.large.label}</span>
              <span class="block text-sm">{t.priceEstimation.bust.sizes.large.description}</span>
            </button>
            <button class="bust-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="lifesize" data-price="12000">
              <span class="block font-semibold">{t.priceEstimation.bust.sizes.lifesize.label}</span>
              <span class="block text-sm">{t.priceEstimation.bust.sizes.lifesize.description}</span>
            </button>
          </div>
        </div>

        <!-- Material Selection -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.bust.selectMaterial}</label>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <button class="bust-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="bronze" data-multiplier="1">
              <span class="block font-semibold">{t.priceEstimation.bust.materials.bronze}</span>
            </button>
            <button class="bust-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="marble" data-multiplier="1.3">
              <span class="block font-semibold">{t.priceEstimation.bust.materials.marble}</span>
            </button>
            <button class="bust-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="resin" data-multiplier="0.6">
              <span class="block font-semibold">{t.priceEstimation.bust.materials.resin}</span>
            </button>
          </div>
        </div>

        <!-- Detail Level -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.bust.detailLevel}</label>
          <div class="grid grid-cols-3 gap-3">
            <button class="bust-detail-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-detail="standard" data-addition="0">
              <span class="block font-semibold">{t.priceEstimation.bust.details.standard}</span>
            </button>
            <button class="bust-detail-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-detail="detailed" data-addition="1500">
              <span class="block font-semibold">{t.priceEstimation.bust.details.detailed}</span>
            </button>
            <button class="bust-detail-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-detail="premium" data-addition="3500">
              <span class="block font-semibold">{t.priceEstimation.bust.details.premium}</span>
            </button>
          </div>
        </div>

        <!-- Estimated Price Display -->
        <div class="mt-8 p-4 bg-brand-dark rounded-lg text-center">
          <p class="text-white text-sm mb-1">{t.priceEstimation.estimatedPrice}</p>
          <p id="bust-price" class="text-3xl font-bold text-white" data-select-options={t.priceEstimation.selectOptions} data-select-all={t.priceEstimation.selectAllOptions}>{t.priceEstimation.selectOptions}</p>
          <p class="text-white/70 text-xs mt-2">{t.priceEstimation.priceDisclaimer}</p>
        </div>

        <!-- Contact CTA -->
        <div class="mt-4 text-center">
          <a href="#contact" class="inline-block px-8 py-3 bg-bmg-gold text-white font-semibold rounded-lg hover:bg-bmg-gold/90 transition-colors">
            {t.priceEstimation.getCustomQuote}
          </a>
        </div>
      </div>

      <!-- Relief Calculator Panel -->
      <div
        id="relief-panel"
        role="tabpanel"
        aria-labelledby="relief-tab"
        class="mt-6 p-6 bg-gray-50 rounded-lg border border-gray-200 hidden"
      >
        <h3 class="text-xl font-semibold text-brand-dark mb-4">{t.priceEstimation.relief.title}</h3>

        <!-- Size Selection -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.relief.selectSize}</label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button class="relief-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="small" data-price="1800">
              <span class="block font-semibold">{t.priceEstimation.relief.sizes.small.label}</span>
              <span class="block text-sm">{t.priceEstimation.relief.sizes.small.description}</span>
            </button>
            <button class="relief-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="medium" data-price="3500">
              <span class="block font-semibold">{t.priceEstimation.relief.sizes.medium.label}</span>
              <span class="block text-sm">{t.priceEstimation.relief.sizes.medium.description}</span>
            </button>
            <button class="relief-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="large" data-price="6000">
              <span class="block font-semibold">{t.priceEstimation.relief.sizes.large.label}</span>
              <span class="block text-sm">{t.priceEstimation.relief.sizes.large.description}</span>
            </button>
            <button class="relief-size-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-size="mural" data-price="10000">
              <span class="block font-semibold">{t.priceEstimation.relief.sizes.mural.label}</span>
              <span class="block text-sm">{t.priceEstimation.relief.sizes.mural.description}</span>
            </button>
          </div>
        </div>

        <!-- Relief Type -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.relief.reliefType}</label>
          <div class="grid grid-cols-3 gap-3">
            <button class="relief-type-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-type="bas" data-multiplier="1">
              <span class="block font-semibold">{t.priceEstimation.relief.types.bas.label}</span>
              <span class="block text-xs">{t.priceEstimation.relief.types.bas.description}</span>
            </button>
            <button class="relief-type-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-type="mezzo" data-multiplier="1.25">
              <span class="block font-semibold">{t.priceEstimation.relief.types.mezzo.label}</span>
              <span class="block text-xs">{t.priceEstimation.relief.types.mezzo.description}</span>
            </button>
            <button class="relief-type-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-type="alto" data-multiplier="1.5">
              <span class="block font-semibold">{t.priceEstimation.relief.types.alto.label}</span>
              <span class="block text-xs">{t.priceEstimation.relief.types.alto.description}</span>
            </button>
          </div>
        </div>

        <!-- Material Selection -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">{t.priceEstimation.relief.selectMaterial}</label>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <button class="relief-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="bronze" data-addition="800">
              <span class="block font-semibold">{t.priceEstimation.relief.materials.bronze}</span>
            </button>
            <button class="relief-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="plaster" data-addition="0">
              <span class="block font-semibold">{t.priceEstimation.relief.materials.plaster}</span>
            </button>
            <button class="relief-material-btn px-4 py-3 border-2 border-brand-dark rounded-lg text-brand-dark hover:bg-brand-dark hover:text-white transition-colors" data-material="stone" data-addition="1200">
              <span class="block font-semibold">{t.priceEstimation.relief.materials.stone}</span>
            </button>
          </div>
        </div>

        <!-- Estimated Price Display -->
        <div class="mt-8 p-4 bg-brand-dark rounded-lg text-center">
          <p class="text-white text-sm mb-1">{t.priceEstimation.estimatedPrice}</p>
          <p id="relief-price" class="text-3xl font-bold text-white" data-select-options={t.priceEstimation.selectOptions} data-select-all={t.priceEstimation.selectAllOptions}>{t.priceEstimation.selectOptions}</p>
          <p class="text-white/70 text-xs mt-2">{t.priceEstimation.priceDisclaimer}</p>
        </div>

        <!-- Contact CTA -->
        <div class="mt-4 text-center">
          <a href="#contact" class="inline-block px-8 py-3 bg-bmg-gold text-white font-semibold rounded-lg hover:bg-bmg-gold/90 transition-colors">
            {t.priceEstimation.getCustomQuote}
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Tab switching functionality
  document.addEventListener('DOMContentLoaded', () => {
    const bustTab = document.getElementById('bust-tab');
    const reliefTab = document.getElementById('relief-tab');
    const bustPanel = document.getElementById('bust-panel');
    const reliefPanel = document.getElementById('relief-panel');

    function switchTab(activeTab: string) {
      if (activeTab === 'bust') {
        // Update tab styles
        bustTab?.classList.remove('bg-brand-medium', 'hover:bg-brand-medium-hover');
        bustTab?.classList.add('bg-brand-dark');
        bustTab?.setAttribute('aria-selected', 'true');

        reliefTab?.classList.remove('bg-brand-dark');
        reliefTab?.classList.add('bg-brand-medium', 'hover:bg-brand-medium-hover');
        reliefTab?.setAttribute('aria-selected', 'false');

        // Show/hide panels
        bustPanel?.classList.remove('hidden');
        reliefPanel?.classList.add('hidden');
      } else {
        // Update tab styles
        reliefTab?.classList.remove('bg-brand-medium', 'hover:bg-brand-medium-hover');
        reliefTab?.classList.add('bg-brand-dark');
        reliefTab?.setAttribute('aria-selected', 'true');

        bustTab?.classList.remove('bg-brand-dark');
        bustTab?.classList.add('bg-brand-medium', 'hover:bg-brand-medium-hover');
        bustTab?.setAttribute('aria-selected', 'false');

        // Show/hide panels
        reliefPanel?.classList.remove('hidden');
        bustPanel?.classList.add('hidden');
      }
    }

    bustTab?.addEventListener('click', () => switchTab('bust'));
    reliefTab?.addEventListener('click', () => switchTab('relief'));

    // Keyboard navigation
    [bustTab, reliefTab].forEach(tab => {
      tab?.addEventListener('keydown', (e: KeyboardEvent) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          const currentTab = e.key === 'ArrowRight' ? 'relief' : 'bust';
          switchTab(currentTab);
          (currentTab === 'bust' ? bustTab : reliefTab)?.focus();
        }
      });
    });

    // Helper function to setup option buttons
    function setupOptionButtons(selector: string, callback: (btn: HTMLElement) => void) {
      document.querySelectorAll(selector).forEach(btn => {
        btn.addEventListener('click', (e) => {
          // Remove selected state from siblings
          document.querySelectorAll(selector).forEach(b => {
            b.classList.remove('bg-brand-dark', 'text-white');
            b.classList.add('text-brand-dark');
          });

          // Add selected state to clicked button
          const target = e.currentTarget as HTMLElement;
          target.classList.add('bg-brand-dark', 'text-white');
          target.classList.remove('text-brand-dark');

          callback(target);
        });
      });
    }

    // Bust Calculator Logic
    let bustSelections = { size: null as number | null, material: null as number | null, detail: null as number | null };

    setupOptionButtons('.bust-size-btn', (btn) => {
      bustSelections.size = parseFloat(btn.dataset.price || '0');
      calculateBustPrice();
    });

    setupOptionButtons('.bust-material-btn', (btn) => {
      bustSelections.material = parseFloat(btn.dataset.multiplier || '1');
      calculateBustPrice();
    });

    setupOptionButtons('.bust-detail-btn', (btn) => {
      bustSelections.detail = parseFloat(btn.dataset.addition || '0');
      calculateBustPrice();
    });

    function calculateBustPrice() {
      const priceEl = document.getElementById('bust-price');
      if (bustSelections.size !== null && bustSelections.material !== null && bustSelections.detail !== null) {
        const total = (bustSelections.size * bustSelections.material) + bustSelections.detail;
        if (priceEl) priceEl.textContent = `$${total.toLocaleString()}`;
      } else {
        if (priceEl) priceEl.textContent = priceEl.dataset.selectAll || 'Select all options';
      }
    }

    // Relief Calculator Logic
    let reliefSelections = { size: null as number | null, type: null as number | null, material: null as number | null };

    setupOptionButtons('.relief-size-btn', (btn) => {
      reliefSelections.size = parseFloat(btn.dataset.price || '0');
      calculateReliefPrice();
    });

    setupOptionButtons('.relief-type-btn', (btn) => {
      reliefSelections.type = parseFloat(btn.dataset.multiplier || '1');
      calculateReliefPrice();
    });

    setupOptionButtons('.relief-material-btn', (btn) => {
      reliefSelections.material = parseFloat(btn.dataset.addition || '0');
      calculateReliefPrice();
    });

    function calculateReliefPrice() {
      const priceEl = document.getElementById('relief-price');
      if (reliefSelections.size !== null && reliefSelections.type !== null && reliefSelections.material !== null) {
        const total = (reliefSelections.size * reliefSelections.type) + reliefSelections.material;
        if (priceEl) priceEl.textContent = `$${total.toLocaleString()}`;
      } else {
        if (priceEl) priceEl.textContent = priceEl.dataset.selectAll || 'Select all options';
      }
    }
  });
</script>
